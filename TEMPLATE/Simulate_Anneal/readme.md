#

**参考链接 :** [模拟退火算法详解](https://zhuanlan.zhihu.com/p/266874840)

整体其实是一个调参的过程 : **所以非必要不需要用 模拟退火 (有罚时爆表的风险)**

## 模拟退化 Simulate_Anneal

模拟退火算法(Simulated Annealing,SA)最早的思想是由 `N. Metropolis` 等人于1953年提出。1983年, `S. Kirkpatrick` 等成功地将退火思想引入到组合优化领域。它是基于 `Monte-Carlo` 迭代求解策略的一种 `随机寻优算法` ，其出发点是基于物理中固体物质的退火过程与一般组合优化问题之间的相似性。

---

### 模拟退火核心思想

模拟退火算法从某一较高初温出发，伴随温度参数的不断下降,结合一定的概率突跳特性在解空间中随机寻找目标函数的全局最优解，即在局部最优解能概率性地跳出并最终趋于全局最优。

这里的 `“一定的概率”` 的计算参考了 `金属冶炼` 的退火过程，这也是模拟退火算法名称的由来。将 `温度T` 当作控制参数，`目标函数值f` 视为 `内能E`，而固体在某温度T时的一个状态对应一个解 `xi`，然后算法试图随着控制参数T的降低，使 `目标函数f(内能E)` 也逐渐降低，直至趋于 `全局最小值`（退火中低温时的最低能量状态），就像金属退火过程一样。

关于 `爬山算法` 与 `模拟退火`，有一个有趣的比喻：
- 爬山算法：兔子朝着比现在高的地方跳去。它找到了不远处的最高山峰。但是这座山不一定是珠穆朗玛峰。这就是爬山算法，它不能保证局部最优值就是全局最优值。
- 模拟退火：兔子喝醉了。它随机地跳了很长时间。这期间，它可能走向高处，也可能踏入平地。但是，它渐渐清醒了并朝最高方向跳去。这就是模拟退火。

---

### 模拟退火数学原理

从上面我们知道，会结合概率突跳特性在解空间中随机寻找目标函数的全局最优解，那么具体的更新解的机制是什么呢？如果新解比当前解更优，则接受新解，否则基于 `Metropolis准则` 判断是否接受新解。接受概率为：

$$ P = \left\{
    \begin{aligned}
    1 & , & E_{t+1} & < & E_t \\
    e^{{-(E_{t+1} - E_t)}/{kT}} & , & E_{t + 1} & \ge & E_t
    \end{aligned}
    \right.
$$

如上公式，假设当前时刻搜索的解为 $x_i$，对应的系统能量(目标函数)为 $E_t$，对搜索点施加随机扰动，产生新解 $x_{i+1}$，相应地，系统能量为 $E_{t+1}$，那么系统对搜索点从 $x_t$ 到 $x_{t+1}$ 转变的接受概率就为上公式。

---

### 模拟退火流程

算法实质分两层循环，在任一温度水平下，随机扰动产生新解，并计算目标函数值的变化，决定是否被接受。由于算法初始温度比较高，这样，使 `E` 增大的新解在初始时也可能被接受，因而能跳出局部极小值，然后通过缓慢地降低温度，算法就最终可能收敛到全局最优解，具体流程为：

1. 令 `T = T0` ,表示开始退火的初始温度，随机产生一个初始解 `x0`,并计算对应的目标函数值 `E(x0)`
2. 令 `T = kT`,其中 `k` 取值 `0` 到 `1` 之间，为温度下降速率
3. 对当前解 `xt` 施加随机扰动，在其邻域内产生一个新解 `x(t+1)`，并计算对应的目标函数值 `E(x(t+1))`,计算

    $$\Delta E = E(x_{t+1}) - E(x_t)$$

   - 若 $\Delta E < 0$ 则接受新解 , 否则按照概率判断是否接受新解
   - 判断温度是否达到终止温度水平，若是则终止算法，否则返回步骤2.


[![Ohzzzn.png](https://s1.ax1x.com/2022/05/17/Ohzzzn.png)](https://imgtu.com/i/Ohzzzn)


其中有几个需要注意的点：

初始点的选取对算法结果有一定的影响，最好是多次运行对结果进行综合判断。
在算法运行初期，温度下降快，避免接受过多的差结果。当运行时间增加，温度下降减缓，以便于更快稳定结果。
当迭代次数增加到一定次数时，结果可能已经达到稳定，但是距离算法结束还有一段时间。在设计程序时应该加入适当的输出条件，满足输出条件即可结束程序。

### 模拟退火代码

具体看 `./Simulate_Anneal.h`
