#

**参考链接 :** [动态开点线段树](https://www.cnblogs.com/fusiwei/p/12628596.html)

## 动态开点线段树 (Dynamic OpenPoint seqment tree)

如果现在要让你维护一棵 `[1:1e9]` 长度区间的 `线段树`。按 `线段树` 开的话，四倍空间是 `4×1e9`，空间必炸。

所谓动态开点，就是用什么开什么。简单的说，就是建立一棵 `残疾` 的线段树，上面只有询问过的相关节点。从而节约了大量空间，让上面的 `1e9` 线段树成为可行。

其实看这个 `动态开点` 的名字就能隐约猜到这个概念和功能。

这样的话，我们最后的空间复杂度只与询问次数有关，也就是 `O(qlogN)`。

### 核心思想

对于普通的线段树来说 , 某一个节点的 `lson` 和 `rson` 是通过 `idx * 2` 和 `idx * 2 + 1` 来访问的。所以我们需要 **预先把全部的节点都构造出来** , 然后通过这样的方式来访问。这样就相当于某一个节点无论我们是否需要访问 , 我们都先构建了出来 , 因此当初始区间长度较大时 , 我们就需要开辟很大的空间来支撑 `线段树` 的功能。

为了解决这个问题 , 我们可以采用 `人工分配 序号` 的方式来产生 `lson` 和 `rson`。玄妙之处就是 —— 就是 **节点的编号** 和 **节点左右儿子** 的编号都是 **乱序** 的，是我们临到使用之时现加上去的。**即用到左右子树时才进行创建**。这样最后我们保存的信息都是我们所需要用的。所以及时初始区间比较大 , 我们也通过这样的方式来使用 `线段树` 的功能。
